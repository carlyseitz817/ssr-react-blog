{"version":3,"file":"static/webpack/static\\development\\pages\\_app.js.1915df122daccc400ff4.hot-update.js","sources":["webpack:///./services/auth0.js"],"sourcesContent":["//auth0 goes here\nimport auth0 from 'auth0-js';\nimport Cookies from 'js-cookie';\nimport jwt from 'jsonwebtoken';\nimport axios from 'axios';\n\nclass Auth {\n    constructor() {\n        this.auth0 = new auth0.WebAuth(\n            {\n                domain: 'dev-ofwx6q85.auth0.com',\n                clientID: '7ZE6aNVCenqc2Ghy21fA7VcWbzcgPEWz',\n                redirectUri: 'http://localhost:3000/callback',\n                responseType: 'token id_token',\n                scope: 'openid profile',\n            });\n\n        this.login = this.login.bind(this);\n        this.logout = this.logout.bind(this);\n        this.handleAuthentication = this.handleAuthentication.bind(this);\n        // this.isAuthenticated = this.isAuthenticated.bind(this);\n\n    };\n\n    handleAuthentication() {\n        return new Promise((resolve, reject) => {\n            this.auth0.parseHash((err, authResult) => {\n                if (authResult && authResult.accessToken && authResult.idToken) {\n                    this.setSession(authResult);\n                    resolve();\n                }\n                else if (err) {\n\n                    reject(err);\n\n                    // history.replace('/home');\n\n                    console.log(err);\n\n                    alert('Whoops! Something went wrong! Error: ${err.error}. Check the console for further details.');\n                }\n            });\n        })\n    }\n\n    setSession(authResult) {\n\n        localStorage.setItem('isLoggedIn', 'true');\n\n        const expiresAt = (authResult.expiresIn * 1000) + new Date().getTime();\n\n        Cookies.set('user', authResult.idTokenPayload);\n        Cookies.set('jwt', authResult.idToken);\n        Cookies.set('expiresAt', expiresAt);\n\n        console.log('You are now logged in!')\n    }\n\n    logout() {\n        Cookies.remove('user');\n        Cookies.remove('jwt');\n        Cookies.remove('expiresAt');\n\n        this.auth0.logout({\n            returnTo: 'http://localhost:3000',\n            clientID: 'lEopvK1CVu4NTl5j5EnvgWCOlSKnMRsZ'\n        })\n\n        console.log('Leaving so soon? :(')\n    }\n\n    login() {\n        this.auth0.authorize()\n    }\n\n    // isAuthenticated() {\n    //     const expiresAt = Cookies.getJSON('expiresAt');\n    //     return new Date().getTime() < expiresAt;\n    // }\n\n    async getJWKS() {\n\n    const res = await axios.get('https://dev-ofwx6q85.auth0.com/.well-known/jwks.json');\n    const jwks = res.data;\n    return jwks;\n    }\n\n    verifyToken(token) {\n        if (token) {\n            const decodedToken = jwt.decode(token, { complete: true});\n            const expiresAt = decodedToken.exp * 1000;\n\n            return (decodedToken && new Date().getTime() < expiresAt) ? decodedToken : undefined;\n        }\n\n        return undefined;\n    }\n\n    clientAuth() {\n        var token = Cookies.getJSON(\"jwt\");\n        const verifiedToken = this.verifyToken(token);\n\n        return verifiedToken;\n        // return this.isAuthenticated();\n    }\n\n    serverAuth(req) {\n        if (req.headers.cookie) {\n            const tokenCookie = req.headers.cookie.split(\";\").find(c => c.trim().startsWith(\"jwt=\"));\n\n            if (!tokenCookie) {\n                return undefined\n            }\n\n            const token = tokenCookie.split(\"=\")[1];\n            const verifiedToken = this.verifyToken(token);\n\n            return token;\n        }\n        return undefined;\n    }\n}\n\nconst auth0client = new Auth();\n\nexport default auth0client;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAQA;AACA;AACA;AAGA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAGA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;;;AAEA;AAEA;AAEA;AAEA;AACA;AACA;AAEA;AACA;;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAFA;AAKA;AACA;;;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;;;;;;;;;;;;;AAGA;AACA;;AADA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AAEA;AAEA;;;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;;;;;;AAGA;AAEA;;;;A","sourceRoot":""}